<!-- Toast fixo -->
<div class="toast-container position-fixed bottom-0 end-0 p-3">
  <div id="liveToast" class="toast align-items-center text-white border-0" role="alert" aria-live="assertive"
    aria-atomic="true" [ngClass]="{
          'bg-success': toastType === 'success',
          'bg-danger': toastType === 'error'
       }">
    <div class="d-flex">
      <div class="toast-body">
        {{ mensagemToast }}
      </div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
        aria-label="Close"></button>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal fade " id="detalhePedido" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable">
    <div class="modal-content modal-dialog-scrollable">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">Detalhe do pedido {{detalhe.id}}</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <h6>{{detalhe.cliente.nome}}</h6>
        <strong>TOTAL:</strong>{{detalhe.valorTotal | currency: 'BRL' }}
        <p><strong>Endereço:</strong> {{detalhe.cliente.logradouro}} - {{detalhe.cliente.numero}}<br>
          {{detalhe.cliente.bairro}} - {{detalhe.cliente.cidade}} - {{detalhe.cliente.cep}}
        </p>
        <strong>Observações:</strong>{{detalhe.observacoes}}
        <hr>
        <h6>Itens</h6>
        <table>
          <thead>
            <th scope="col">Foto</th>
            <th scope="col">Produto</th>
            <th scope="col">Valor Unitário</th>
            <th scope="col">Quant</th>
            <th scope="col">Valor Total</th>
          </thead>
          <tbody>

            @for(item of detalhe.itensPedido; track detalhe) {
            <hr>
            <tr>
              <td> <img src="{{item.peca.linkFoto}}" height="50px"></td>
              <td>{{item.peca.nome}}</td>
              <td>{{item.precoUnitario | currency: 'BRL'}}</td>
              <td>{{item.qtdtItem}}</td>
              <td>{{item.precoTotal | currency: 'BRL'}}</td>
            </tr>
            }
          </tbody>
        </table>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>

      </div>
    </div>
  </div>
</div>

<!-- Button trigger modal -->
<button type="button" id="btnModal" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#detalhePedido">
  Launch demo modal
</button>

<!-- modal do financeiro -->
<div class="modal fade " id="financeiroModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Geração do Status Financeiro: Pedido
                    #{{detalhe.id}}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <select id="selectPgto" class="form-control" [(ngModel)]="registroFinanceiro.formaPagamento.numSeq">
                    @for (FORMA of formasPgto; track formasPgto) {
                      <option value="{{FORMA.numSeq}}">
                        {{FORMA.descricao}}
                      </option>
                    }
                </select>
                <label for="txtDataVencimento">Digite a data do vencimento</label>
                <input type="number" id="txtDataVencimento" min="1" max="31"
                    [(ngModel)]="registroFinanceiro.diaVencimento" class="form-control">

                <label for="txtParcelas">Digite o numero de parcelas</label>
                <input type="number" id="txtParcelas" min="1" max="10" [(ngModel)]="registroFinanceiro.totalParcelas"
                    class="form-control">
                <label for="selectPgto">Selecione a forma de Pagamento</label>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal" (click)="gerarFluxo()">Gerar
                    Fluxo</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            </div>
        </div>
    </div>
</div>
<!-- botao do modal do financeiro -->
<button type="button" id="btnModalFinanceiro" class="btn btn-primary" data-bs-toggle="modal"
    data-bs-target="#financeiroModal">
    Start Modal.
</button>



<div class="container-fluid">
  <div class="row">
    <div class="col-12 text-center">
      <h3>Gerenciar de Pedidos</h3>
    </div>
  </div>
  <div class="accordion" id="accordionExample">
    <div class="accordion-item">
      <h2 class="accordion-header">
        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne"
          aria-expanded="false" aria-controls="collapseOne">
          Aplicar Filtros
        </button>
      </h2>
      <div id="collapseOne" class="accordion-collapse collapse" data-bs-parent="#accordionExample">
        <div class="accordion-body">
                <div class="row mb-4">
        <div class="col-xs-6 col-sm-6 col-md-2 col-lg-2 col-xl-2">
          <label for="divIni" class="d-flex justify-content-center">Data de Inicio</label>
          <input type="date" class="form-control" id="txtDataIni" [(ngModel)] ="filtroPedidoDTO.dataInicio">
        </div>
        <div class="col-xs-6 col-sm-6 col-md-2 col-lg-2 col-xl-2">
          <label for="divFim" class="d-flex justify-content-center">Data de Fim</label>
           <input type="date" class="form-control" id="txtDataFim" [(ngModel)] = "filtroPedidoDTO.dataFim">
        </div>

        <div class="col-xs-12 col-sm-12 col-md-4 col-lg-4 col-xl-4">
          <label for="txtNomeCli" class="d-flex justify-content-center">Nome do Cliente</label>
           <input type="text" class="form-control" [(ngModel)] = "filtroPedidoDTO.nome">
        </div>

        <div class="col-sm-12 col-xs-12 col-md-2 col-lg-2 col-xl-2 d-flex flex-column align-items-center justify-content-center">
          <label for="checks" >Status</label>
         <div id="checks" class="d-flex justify-content-center">
        <!-- filtro 0 NOVO-->
        <input type="checkbox" name="chkNovo" value="1" class="btn-check" id="chkNovo"
            autocomplete="off" [(ngModel)]="filtroPedidoDTO.novo">
        <label class="btn btn-outline-primary" for="chkNovo"><i
                class="far fa-clipboard"></i></label>
        <!-- filtro 1 PAGO-->
        <input type="checkbox" name="chkPago" value="1" class="btn-check" id="chkPago"
            autocomplete="off" [(ngModel)]="filtroPedidoDTO.pago">
        <label class="btn btn-outline-primary" for="chkPago"><i
                class="fas fa-dollar-sign"></i></label>

        <!-- filtro 2 TRANSPORTE-->
        <input type="checkbox" name="chkTransp" value="1" class="btn-check" id="chkTransp"
            autocomplete="off" [(ngModel)]="filtroPedidoDTO.transporte">
        <label class="btn btn-outline-primary" for="chkTransp"><i
                class="fas fa-shipping-fast"></i></label>

        <!-- filtro 3 ENTREGUE-->
        <input type="checkbox" name="chkEntr" value="1" class="btn-check" id="chkEntr"
            autocomplete="off" [(ngModel)]="filtroPedidoDTO.entregue">
        <label class="btn btn-outline-primary" for="chkEntr"><i
                class="fas fa-hand-holding-heart"></i></label>

        <!-- filtro 4 POS VENDA -->
        <input type="checkbox" name="chkPos" value="1" class="btn-check" id="chkPos"
            autocomplete="off" [(ngModel)]="filtroPedidoDTO.posVenda">
        <label class="btn btn-outline-primary" for="chkPos"><i
                class="far fa-smile-wink"></i></label>

        <!-- filtro 5 FINALIZADO -->
        <input type="checkbox" name="chkFim" value="1" class="btn-check" id="chkFim"
            autocomplete="off" [(ngModel)]="filtroPedidoDTO.finalizado">
        <label class="btn btn-outline-primary" for="chkFim"><i
                class="far fa-check-square"></i></label>

        <!-- filtro 6 CANCELADO-->
        <input type="checkbox" name="chkCanc" value="1" class="btn-check" id="chkCanc"
            autocomplete="off" [(ngModel)]="filtroPedidoDTO.cancelado">
        <label class="btn btn-outline-primary" for="chkCanc"><i
                class="fas fa-window-close"></i></label>
    </div>
        </div>

        <div class="col-sm-12 col-xs-12 col-md-2 col-lg-2 col-xl-2 mt-4 text-center">
          <button type="button" class="btn btn-primary" id="btnFiltrar" (click)="filtrarPedidos()">
            <i class="fas fa-filter me-1"></i> Filtrar
          </button>

          <button type="button" class="btn btn-outline-secondary ms-2" id="btnLimpar" (click)="limparFiltros()">
            <i class="fas fa-broom me-1"></i> Limpar
          </button>
        </div>
    </div>
        </div>
      </div>
    </div>

  </div>

  <table class="table table-hover table-striped">
    <thead>
      <tr>
        <th scope="col">#</th>
        <th scope="col">Data</th>
        <th scope="col">Cliente</th>
        <th scope="col">Total R$</th>
        <th scope="col">Observações</th>
        <th scope="col">Status</th>
   

      </tr>
    </thead>
    <tbody>
      @for(ITEM of lista; track ITEM.id){
      <tr>
        <td>{{ITEM.id}}<i class="fas fa-info-circle" (click)="enviarDetalhes(ITEM)"></i></td>
        <td>{{ITEM.dataPedido | date: 'dd/MM/yyyy'}}</td>
        <td>{{ITEM.cliente.nome}}</td>
        <td><strong>{{ITEM.valorTotal | currency: 'BRL' }}</strong></td>
        <td>{{ITEM.observacoes}}</td>
        <td>
          <div class="btn-group" role="group" aria-label="Basic radio toggle button group">

            <input type="radio" class="btn-check" name="btnradio-{{ITEM.id}}" id="btnradio1-{{ITEM.id}}"
              autocomplete="off" [checked]="ITEM.status == 1" (click)="alterarStatus(ITEM,1)">
            <label class="btn btn-outline-primary" for="btnradio1-{{ITEM.id}}">
              <i class="far fa-clipboard"></i>
            </label>

            <input type="radio" class="btn-check" name="btnradio-{{ITEM.id}}" id="btnradio2-{{ITEM.id}}"
              autocomplete="off" [checked]="ITEM.status == 2" (click)="gerarFinanceiro(ITEM,2)">
            <label class="btn btn-outline-primary" for="btnradio2-{{ITEM.id}}">
              <i class="fas fa-dollar-sign"></i>
            </label>

            <input type="radio" class="btn-check" name="btnradio-{{ITEM.id}}" id="btnradio3-{{ITEM.id}}"
              autocomplete="off" [checked]="ITEM.status == 3" (click)="alterarStatus(ITEM,3)">
            <label class="btn btn-outline-primary" for="btnradio3-{{ITEM.id}}">
              <i  class="fas fa-shipping-fast"></i>
            </label>


            <input type="radio" class="btn-check"  name="btnradio-{{ITEM.id}}" id="btnradio4-{{ITEM.id}}"
              autocomplete="off" [checked]="ITEM.status == 4" (click)="alterarStatus(ITEM,4)">
            <label class="btn btn-outline-primary" for="btnradio4-{{ITEM.id}}">
              <i   class="fas fa-hand-holding-heart"></i>
            </label>

            <input type="radio" class="btn-check"  name="btnradio-{{ITEM.id}}" id="btnradio5-{{ITEM.id}}"
              autocomplete="off" [checked]="ITEM.status == 5" (click)="alterarStatus(ITEM,5)">
            <label class="btn btn-outline-primary" for="btnradio5-{{ITEM.id}}">
              <i  class="far fa-smile-wink"></i>
            </label>

            <input type="radio" class="btn-check"  name="btnradio-{{ITEM.id}}" id="btnradio6-{{ITEM.id}}"
              autocomplete="off" [checked]="ITEM.status == 6" (click)="alterarStatus(ITEM,6)">
            <label class="btn btn-outline-primary"  for="btnradio6-{{ITEM.id}}">
              <i class="far fa-check-square"></i>
            </label>

            <input type="radio" class="btn-check" name="btnradio-{{ITEM.id}}" id="btnradio7-{{ITEM.id}}"
              autocomplete="off" [checked]="ITEM.status == 7" (click)="alterarStatus(ITEM,7)">
            <label class="btn btn-outline-primary"  for="btnradio7-{{ITEM.id}}">
              <i class="fas fa-window-close"></i>
            </label>


          </div>
        </td>

      </tr>
      }
    </tbody>
  </table>

</div>